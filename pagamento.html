<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Pagamento</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .valor-display { background:#e3f2fd; color:#0d47a1; padding:20px; text-align:center; border-radius:8px; border:1px solid #90caf9; margin-bottom:20px;}
        .contract-desc { font-style:italic; color:#555; margin-top:10px; }
    </style>
</head>
<body>
    <header>
        <div class="logo"><h2>üåä Pagamento</h2></div>
        <nav><a href="index.html">Home</a><a href="loja.html">Loja</a><a href="orcamento.html">Or√ßamento</a><a href="pagamento.html" style="border-bottom:2px solid white">Pagamento</a><a href="login.html">Login</a></nav>
    </header>
    <main style="max-width:600px; margin: 80px auto;">
        
        <div id="msg-erro" class="card" style="display:none; text-align:center;">
            <h2 style="color:#d32f2f;">Contrato n√£o encontrado</h2>
            <p>O piscineiro ainda n√£o cadastrou seu contrato.</p>
            <a href="orcamento.html" class="btn" style="margin-top:10px; display:inline-block;">Solicitar Visita</a>
        </div>

        <div id="area-pagamento" class="card" style="display:none;">
            <h2 style="text-align:center; color:var(--primary-blue);">Assinar Contrato</h2>
            <div class="valor-display">
                <p>VALOR MENSAL</p>
                <h3 id="valor-mostra">R$ 0,00</h3>
                <p id="desc-mostra" class="contract-desc">...</p>
            </div>
            <form id="form-assinatura">
                <label>Frequ√™ncia</label><select><option>Mensal</option><option>Anual</option></select>
                <label>Nome no Cart√£o</label><input type="text" required>
                <label>N√∫mero do Cart√£o</label><input type="text" placeholder="0000 0000 0000 0000" required>
                <div style="display:flex; gap:10px;"><input type="text" placeholder="MM/AA" required><input type="text" placeholder="CVV" required></div>
                <button type="submit" class="btn" style="width:100%">Confirmar Assinatura</button>
            </form>
        </div>
    </main>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script>
        const sessionStr = localStorage.getItem("@limpapiscina/session");
        if (!sessionStr) { alert("Fa√ßa login primeiro."); window.location.href = "login.html"; }
        else {
            const user = JSON.parse(sessionStr);
            const plano = getMeuPlano(user.email); // Busca no 'banco de dados'
            if (plano && plano.valor) {
                document.getElementById('area-pagamento').style.display = 'block';
                document.getElementById('valor-mostra').innerText = parseFloat(plano.valor).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
                document.getElementById('desc-mostra').innerText = `"${plano.descricao}"`;
            } else {
                document.getElementById('msg-erro').style.display = 'block';
            }
        }
        document.getElementById('form-assinatura').addEventListener('submit', (e)=>{ e.preventDefault(); alert("Assinatura confirmada!"); window.location.href="index.html"; });
    </script>
</body>
</html>
